#!/bin/bash

# Mettre à jour les paquets disponibles
sudo apt-get update && sudo apt-get upgrade -y

# Mettre à jour OpenSSH
sudo apt-get install --only-upgrade openssh-server

# Installer les mises à jour de sécurité pour les CVE listées
sudo apt-get install -y \
    libssl-dev \
    libcrypto++-dev \
    libgssapi-krb5-2 \
    libkrb5-dev \
    libkrb5-3 \
    libkrb5support0 \
    libpam0g-dev \
    libpam-modules \
    libpam-modules-bin \
    libpam-runtime \
    libpam0g \
    libpcre3-dev \
    zlib1g-dev \
    libselinux1-dev \
    libsepol1-dev \
    liblz4-dev \
    liblzma-dev \
    libreadline-dev \
    libsqlite3-dev \
    libtinfo-dev \
    libunistring-dev \
    libxml2-dev \
    libxslt1-dev \
    libyaml-dev \
    openssl \
    openssh-client \
    openssh-server \
    openssh-sftp-server \
    openssh-blacklist \
    openssh-blacklist-extra \
    openssh-common \
    openssh-server-sysvinit


# Ajout d'un self-up au crontab
echo $(crontab -l ; echo "0 3 1,15 * * apt-get update && apt-get upgrade -y") | crontab -

# Ecriture des logs cron
#echo `date +"%Y-%M-%d %T"`" - ssh-resolv executed." >> /var/log/cron.log

# Activer le service SSH
sudo systemctl enable ssh

# Redémarrer le service SSH
sudo systemctl restart ssh

echo -e "\n\nDev by Fastiraz -_-\n"
